<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ACUMEN Studio | Akıllı Şablon Oluşturucu</title>
  <link rel="icon" href="data:,">

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>

  <link rel="stylesheet" href="./ss.css">

<script>
  // ACUMEN_STUDIO_UX_PLACEHOLDER
  window.ACUMEN_STUDIO_UX = window.ACUMEN_STUDIO_UX || {};
</script>

</head>
<body>

<header>
  <div class="logo-area">
    <h1>ACUMEN <span style="font-weight:300">STUDIO</span></h1>
  </div>

  <div class="header-group" id="pageControls" style="display:none;">
        <button class="btn primary" onclick="fileInp.click()">
          <span class="material-icons-round">upload_file</span> Kaynak Yükle
        </button>

    <button class="btn ghost icon" onclick="window.ACUMEN_STUDIO_UX?.openShortcuts?.()" title="Önceki Sayfa">
      <span class="material-icons-round">navigate_before</span>
    </button>
    <span id="pageInfo" style="font-weight:600; min-width:110px; text-align:center;">Sayfa 1 / 1</span>
    <button class="btn ghost icon" onclick="window.ACUMEN_STUDIO_UX?.openShortcuts?.()" title="Sonraki Sayfa">
      <span class="material-icons-round">navigate_next</span>
    </button>

    <div style="width:1px; height:26px; background: rgba(255,255,255,0.12); margin:0 4px;"></div>

    <button class="btn ghost icon" onclick="window.ACUMEN_STUDIO_UX?.openShortcuts?.()" title="Yakınlaştır (-)">
      <span class="material-icons-round">remove</span>
    </button>
    <span id="zoomInfo" style="font-weight:700; min-width:62px; text-align:center;">100%</span>
    <button class="btn ghost icon" onclick="window.ACUMEN_STUDIO_UX?.openShortcuts?.()" title="Yakınlaştır (+)">
      <span class="material-icons-round">add</span>
    </button>
    <button class="btn ghost" onclick="window.ACUMEN_STUDIO_UX?.openShortcuts?.()" title="Zoom Sıfırla" style="height:38px;">%100</button>
  </div>

  <div class="header-group">
<input type="file" id="fileInp" accept="application/pdf,image/png,image/jpeg,image/webp" style="display:none">
  </div>

<div style="font-size:11px; color:rgba(244,244,245,0.65); margin-top:4px; text-align:right;">PDF • JPG • PNG • WEBP</div>
</header>

<main>
  <div id="pdfWrapper">
<div id="emptyState" class="empty-state glass-card">

  <div class="section-title" style="justify-content:center; margin-bottom:10px;">
    <span class="material-icons-round" style="font-size:16px">auto_awesome</span>
    Hazırız
  </div>

  <div style="font-size:13px; color:rgba(244,244,245,0.88); line-height:1.3; text-align:center;">
    PDF veya resim (JPG/PNG/WEBP) yükleyince işaretleme ekranı burada açılacak.<br>
    <span style="color:var(--muted);">İpucu:</span> Kutu çiz → liste → aktar.
  </div>

  <!-- BUTTON AREA -->
  <div style="display:flex; justify-content:center; margin-top:14px;">
    <button class="btn primary"
            style="width:auto; padding:10px 18px;"
            onclick="fileInp.click()">
      <span class="material-icons-round">upload_file</span>
      Kaynak Yükle
    </button>
  </div>

  <div id="emptyFormatsHint"
       style="margin-top:8px; font-size:11px; color:var(--muted); text-align:center;">
    Desteklenen: PDF • JPG • PNG • WEBP
  </div>

  <div style="display:flex; gap:10px; justify-content:center; margin-top:12px; flex-wrap:wrap;">
    <button class="btn ghost"
            style="width:auto; padding:10px 14px;"
            onclick="window.ACUMEN_STUDIO_UX?.openShortcuts?.()">
      <span class="material-icons-round">tips_and_updates</span>
      Kısayollar
    </button>
  </div>

</div>

    <div id="canvasContainer" style="display:none;">
      <canvas id="pdfCanvas"></canvas>
      <div id="overlayLayer"></div>
      <div id="selectionRect"></div>
    </div>
  </div>

  <aside id="sidebar">
    <div class="glass-card">
      <div class="section-title">
        <span class="material-icons-round" style="font-size:14px">brush</span> Hızlı İşaretleme
      </div>
      <div style="font-size:12px; color:var(--muted); line-height:1.4;">
        Soruyu kutu içine alman yeterli. <b>İpucu:</b> Yanlış çizdiysen <b>Ctrl+Z</b> ile geri al, <b>Esc</b> ile çizimi iptal et.
      </div>
      <div style="font-size:12px; color:rgba(244,244,245,0.85); margin-top:10px; line-height:1.4;">
        <span style="opacity:.8;">Kısayollar:</span>
        <span style="display:inline-block; margin-left:8px;">Ctrl+Z (Undo)</span> •
        <span style="display:inline-block; margin-left:8px;">Esc (İptal)</span> •
        <span style="display:inline-block; margin-left:8px;">Ctrl+Wheel (Zoom)</span>
      </div>
    </div>

    <div id="qList"></div>

    <div class="glass-card">
      <button class="btn primary" onclick="exportToApp()">
        <span class="material-icons-round">bolt</span> Aktarımı Tamamla
      </button>
      <div style="font-size:12px; color:var(--muted); margin-top:10px; line-height:1.35;">
        Not: Cevap anahtarı boş gider; ana uygulamada AI ile oluşturulabilir.
      </div>

      <div id="ocrBox" style="display:none; margin-top:12px;">
        <div class="section-title" style="margin-bottom:8px;">
          <span class="material-icons-round" style="font-size:14px;">auto_fix_high</span> OCR
        </div>
        <div style="font-size:12px; color:rgba(244,244,245,0.88); line-height:1.4;" id="ocrStatus">Hazırlanıyor…</div>
        <div class="progress" aria-label="OCR Progress">
          <div id="ocrBar"></div>
        </div>
      </div>

    </div>
  </aside>
</main>

<div id="toast"><div class="t-title"></div><div class="t-msg"></div></div>

<script type="module">
  // ACUMEN Studio loader (supports multiple base paths)
  (async () => {
    const candidates = [
      "./sinav-v2/js/studio/main.js",
      "./js/studio/main.js",
      "./studio/main.js"
    ];
    let lastErr = null;
    for (const p of candidates) {
      try { await import(p); return; }
      catch (e) { lastErr = e; }
    }
    console.error("ACUMEN Studio: main.js bulunamadı. Denenen yollar:", candidates, lastErr);
    alert("Studio JS bulunamadı. Dosya yolu hatalı: " + candidates.join(" | "));
  })();
</script>


<script>
/* === ACUMEN_DRIVE_AUTO (v16) ===
   If opened with ?from=drive&fileId=..., tries to download PDF from Drive using cached OAuth token.
*/
(function(){
  const params = new URLSearchParams(location.search);
  const fileId = params.get("fileId");
  if (!fileId) return;

  async function downloadPdfFromDrive(fileId){
    const token = localStorage.getItem("acumen_google_access_token");
    if (!token) throw new Error("Drive token yok. Ana uygulamada Drive Listele ile izin verip tekrar dene.");
    const url = `https://www.googleapis.com/drive/v3/files/${encodeURIComponent(fileId)}?alt=media`;
    const res = await fetch(url, { headers: { Authorization: `Bearer ${token}` } });
    if (!res.ok){
      const txt = await res.text().catch(()=> "");
      throw new Error(`Drive PDF indirilemedi (${res.status}): ${txt || res.statusText}`);
    }
    const blob = await res.blob();
    return new File([blob], (params.get("name") || "drive.pdf"), { type: "application/pdf" });
  }

  async function injectIntoFileInput(file){
    const inp = document.getElementById("fileInp");
    if (!inp) throw new Error("Studio file input bulunamadı (fileInp).");
    const dt = new DataTransfer();
    dt.items.add(file);
    inp.files = dt.files;
    inp.dispatchEvent(new Event("change", { bubbles: true }));
  }

  // Start after DOM ready
  window.addEventListener("load", async () => {
    try {
      const file = await downloadPdfFromDrive(fileId);
      await injectIntoFileInput(file);
      console.log("Drive PDF otomatik yüklendi:", file.name);
    } catch (e){
      console.error(e);
      const el = document.getElementById("status") || document.querySelector(".status") || null;
      if (el) el.textContent = e.message || String(e);
      alert(e.message || String(e));
    }
  });
})();
</script>


  <!-- Shortcuts Modal -->
  <div id="shortcutsBackdrop" class="acumen-modal-backdrop" style="display:none;">
    <div class="acumen-modal" role="dialog" aria-modal="true" aria-label="Kısayollar">
      <div class="acumen-modal-head">
        <div style="display:flex; align-items:center; gap:10px;">
          <span class="material-icons-round" style="font-size:18px;">keyboard</span>
          <div>
            <div style="font-weight:700; letter-spacing:0.2px;">Kısayollar</div>
            <div style="font-size:12px; color:var(--muted); margin-top:2px;">Hızlı işaretleme için</div>
          </div>
        </div>
        <button class="btn ghost icon" style="width:38px; height:34px; padding:0;" onclick="window.ACUMEN_STUDIO_UX?.closeShortcuts?.()" aria-label="Kapat">
          <span class="material-icons-round" style="font-size:18px;">close</span>
        </button>
      </div>

      <div class="acumen-modal-body">
        <div class="acumen-kbd-grid">
          <div class="acumen-kbd-row">
            <div class="acumen-kbd"><span>Ctrl</span> <span>+</span> <span>Z</span></div>
            <div class="acumen-kbd-desc">Geri al (son kutuyu kaldırır)</div>
          </div>
          <div class="acumen-kbd-row">
            <div class="acumen-kbd"><span>Esc</span></div>
            <div class="acumen-kbd-desc">Çizimi iptal et</div>
          </div>
          <div class="acumen-kbd-row">
            <div class="acumen-kbd"><span>Ctrl</span> <span>+</span> <span>Wheel</span></div>
            <div class="acumen-kbd-desc">Yakınlaştır / Uzaklaştır</div>
          </div>
          <div class="acumen-kbd-row">
            <div class="acumen-kbd"><span>Click</span></div>
            <div class="acumen-kbd-desc">Kutuyu seç (taşı / yeniden boyutla)</div>
          </div>
        </div>

        <div style="margin-top:14px; font-size:12px; color:var(--muted); line-height:1.4;">
          İpucu: Soru listesinden bir soruya tıklayınca otomatik odaklanır.
        </div>
      </div>

      <div class="acumen-modal-foot">
        <button class="btn primary" onclick="window.ACUMEN_STUDIO_UX?.closeShortcuts?.()">
          <span class="material-icons-round" style="font-size:18px;">done</span> Tamam
        </button>
      </div>
    </div>
  </div>

</body>
</html>